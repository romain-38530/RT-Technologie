(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[214],{830:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/palettes",function(){return i(3915)}])},3915:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return a}});var s=i(7458),n=i(2983);let r=i(2019).env.NEXT_PUBLIC_PALETTE_API_URL||"http://localhost:3011";async function d(e,t){let i=localStorage.getItem("admin_jwt"),s={"Content-Type":"application/json",...i&&{Authorization:"Bearer ".concat(i)},...null==t?void 0:t.headers},n=await fetch("".concat(r).concat(e),{...t,headers:s});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Unknown error"}))).error||"HTTP ".concat(n.status));return n.json()}let l={getAllCheques:async()=>{throw Error("Endpoint non disponible - \xc0 impl\xe9menter dans le service palette")},getCheque:async e=>(await d("/palette/cheques/".concat(e))).cheque,getAllLedgers:async e=>await Promise.all(e.map(e=>l.getLedger(e))),getLedger:async e=>(await d("/palette/ledger/".concat(e))).ledger,getSites:async()=>(await d("/palette/sites")).sites,getSite:async e=>d("/palette/sites/".concat(e)),updateSiteQuota:async(e,t)=>(await d("/palette/sites/".concat(e,"/quota"),{method:"POST",body:JSON.stringify(t)})).quota,createSite:async e=>{throw Error("Endpoint non disponible - \xc0 impl\xe9menter dans le service palette")},deactivateSite:async e=>{throw Error("Endpoint non disponible - \xc0 impl\xe9menter dans le service palette")},getDisputes:async()=>(await d("/palette/disputes")).disputes,resolveDispute:async(e,t,i)=>{throw Error("Endpoint non disponible - \xc0 impl\xe9menter dans le service palette")},getAnalytics:async()=>{throw Error("Endpoint non disponible - Calcul\xe9 c\xf4t\xe9 client \xe0 partir des donn\xe9es")},exportToCSV:(e,t)=>{let i=Object.keys(e[0]||{}),s=new Blob([[i.join(","),...e.map(e=>i.map(t=>JSON.stringify(e[t]||"")).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),n=document.createElement("a");n.href=URL.createObjectURL(s),n.download=t,n.click()}};function a(){let[e,t]=(0,n.useState)("dashboard"),[i,r]=(0,n.useState)(!1),[d,a]=(0,n.useState)(null),[o,c]=(0,n.useState)([]),[p,h]=(0,n.useState)([]),[g,u]=(0,n.useState)([]),[x,y]=(0,n.useState)(null),[f,m]=(0,n.useState)(null),[j,b]=(0,n.useState)("ALL"),[v,S]=(0,n.useState)("");async function E(){r(!0),a(null);try{let[e,t]=await Promise.all([l.getSites(),l.getDisputes()]);c(e),u(t);let i=[...new Set(e.map(e=>e.companyId))],s=await l.getAllLedgers(i);h(s)}catch(e){a(e.message)}finally{r(!1)}}async function R(e){try{let{quota:t}=await l.getSite(e);m(t),y(e)}catch(e){a(e.message)}}async function w(e,t){try{let i=await l.updateSiteQuota(e,{dailyMax:t});m(i);let s=await l.getSites();c(s),alert("Quota mis \xe0 jour avec succ\xe8s")}catch(e){a(e.message)}}(0,n.useEffect)(()=>{E()},[]);let k={totalSites:o.length,totalLedgers:p.length,totalDisputes:g.length,openDisputes:g.filter(e=>"OPEN"===e.status).length,totalPallets:p.reduce((e,t)=>e+Math.abs(t.balance),0),positiveBalances:p.filter(e=>e.balance>0).length,negativeBalances:p.filter(e=>e.balance<0).length},C=[...p].filter(e=>e.balance>0).sort((e,t)=>t.balance-e.balance).slice(0,5),B=[...p].filter(e=>e.balance<0).sort((e,t)=>e.balance-t.balance).slice(0,5);return o.map(e=>({...e,quotaConsumed:0})),(0,s.jsxs)("div",{style:{maxWidth:1400,margin:"0 auto",padding:16},children:[(0,s.jsxs)("header",{style:{marginBottom:24},children:[(0,s.jsx)("h1",{style:{fontSize:32,marginBottom:8},children:"Administration Palettes Europe"}),(0,s.jsx)("p",{style:{opacity:.8},children:"Gestion centralis\xe9e des ch\xe8ques palettes, sites de retour, ledgers et litiges"})]}),(0,s.jsx)("nav",{style:{display:"flex",gap:8,borderBottom:"2px solid #eee",marginBottom:24},children:["dashboard","cheques","ledgers","sites","disputes","analytics"].map(i=>(0,s.jsx)("button",{onClick:()=>t(i),style:{padding:"10px 16px",border:"none",background:e===i?"#0a66ff":"transparent",color:e===i?"#fff":"#333",borderRadius:"8px 8px 0 0",cursor:"pointer",fontWeight:e===i?"bold":"normal"},children:i.charAt(0).toUpperCase()+i.slice(1)},i))}),d&&(0,s.jsxs)("div",{style:{padding:16,background:"#fee",color:"#c00",borderRadius:8,marginBottom:16},children:["Erreur: ",d]}),i&&(0,s.jsx)("div",{style:{padding:16,textAlign:"center"},children:"Chargement..."}),"dashboard"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{fontSize:24,marginBottom:16},children:"Tableau de bord"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:16,marginBottom:24},children:[(0,s.jsxs)("div",{style:{padding:16,border:"1px solid #ddd",borderRadius:8,background:"#f9f9f9"},children:[(0,s.jsx)("div",{style:{fontSize:32,fontWeight:"bold",color:"#0a66ff"},children:k.totalSites}),(0,s.jsx)("div",{style:{opacity:.8},children:"Sites de retour"})]}),(0,s.jsxs)("div",{style:{padding:16,border:"1px solid #ddd",borderRadius:8,background:"#f9f9f9"},children:[(0,s.jsx)("div",{style:{fontSize:32,fontWeight:"bold",color:"#0a66ff"},children:k.totalLedgers}),(0,s.jsx)("div",{style:{opacity:.8},children:"Entreprises"})]}),(0,s.jsxs)("div",{style:{padding:16,border:"1px solid #ddd",borderRadius:8,background:"#f9f9f9"},children:[(0,s.jsx)("div",{style:{fontSize:32,fontWeight:"bold",color:"#0a66ff"},children:k.totalPallets}),(0,s.jsx)("div",{style:{opacity:.8},children:"Palettes en circulation"})]}),(0,s.jsxs)("div",{style:{padding:16,border:"1px solid #ddd",borderRadius:8,background:"#fee"},children:[(0,s.jsx)("div",{style:{fontSize:32,fontWeight:"bold",color:"#c00"},children:k.openDisputes}),(0,s.jsx)("div",{style:{opacity:.8},children:"Litiges ouverts"})]})]}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24},children:[(0,s.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:16},children:[(0,s.jsx)("h3",{style:{fontSize:18,marginBottom:12,color:"#080"},children:"Plus gros cr\xe9dits (palettes en stock)"}),0===C.length?(0,s.jsx)("p",{style:{opacity:.6},children:"Aucun cr\xe9dit"}):(0,s.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:C.map(e=>(0,s.jsxs)("li",{style:{padding:"8px 0",borderBottom:"1px solid #eee"},children:[(0,s.jsx)("strong",{children:e.companyId}),": +",e.balance," palettes"]},e.companyId))})]}),(0,s.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:16},children:[(0,s.jsx)("h3",{style:{fontSize:18,marginBottom:12,color:"#c00"},children:"Plus grosses dettes (palettes emprunt\xe9es)"}),0===B.length?(0,s.jsx)("p",{style:{opacity:.6},children:"Aucune dette"}):(0,s.jsx)("ul",{style:{listStyle:"none",padding:0,margin:0},children:B.map(e=>(0,s.jsxs)("li",{style:{padding:"8px 0",borderBottom:"1px solid #eee"},children:[(0,s.jsx)("strong",{children:e.companyId}),": ",e.balance," palettes"]},e.companyId))})]})]}),(0,s.jsx)("button",{onClick:E,style:{padding:"10px 16px",background:"#0a66ff",color:"#fff",border:"none",borderRadius:8,cursor:"pointer"},children:"Rafra\xeechir les donn\xe9es"})]}),"cheques"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{fontSize:24,marginBottom:16},children:"Ch\xe8ques Palettes"}),(0,s.jsx)("p",{style:{opacity:.8,marginBottom:16},children:"Fonctionnalit\xe9 \xe0 venir : Liste compl\xe8te des ch\xe8ques g\xe9n\xe9r\xe9s avec filtres par statut"}),(0,s.jsxs)("div",{style:{padding:16,border:"1px solid #fa0",borderRadius:8,background:"#fff9e6"},children:[(0,s.jsx)("strong",{children:"Note:"})," Le service palette ne fournit pas encore d'endpoint pour lister tous les ch\xe8ques. Il faut ajouter GET /palette/admin/cheques dans le service backend."]})]}),"ledgers"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{fontSize:24,marginBottom:16},children:"Ledgers des entreprises"}),(0,s.jsx)("button",{onClick:function(){let e=p.map(e=>{var t;return{companyId:e.companyId,balance:e.balance,transactions:e.history.length,lastUpdate:(null===(t=e.history[e.history.length-1])||void 0===t?void 0:t.date)||"N/A"}});l.exportToCSV(e,"ledgers-palettes.csv")},style:{padding:"10px 16px",background:"#080",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",marginBottom:16},children:"Exporter CSV"}),(0,s.jsxs)("table",{style:{width:"100%",borderCollapse:"collapse"},children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{style:{background:"#f0f0f0",borderBottom:"2px solid #ddd"},children:[(0,s.jsx)("th",{style:{padding:12,textAlign:"left"},children:"Company ID"}),(0,s.jsx)("th",{style:{padding:12,textAlign:"right"},children:"Solde (palettes)"}),(0,s.jsx)("th",{style:{padding:12,textAlign:"right"},children:"Transactions"}),(0,s.jsx)("th",{style:{padding:12,textAlign:"left"},children:"Derni\xe8re activit\xe9"})]})}),(0,s.jsx)("tbody",{children:p.map(e=>(0,s.jsxs)("tr",{style:{borderBottom:"1px solid #eee"},children:[(0,s.jsx)("td",{style:{padding:12},children:(0,s.jsx)("strong",{children:e.companyId})}),(0,s.jsxs)("td",{style:{padding:12,textAlign:"right",fontWeight:"bold",color:e.balance>0?"#080":e.balance<0?"#c00":"#666"},children:[e.balance>0?"+":"",e.balance]}),(0,s.jsx)("td",{style:{padding:12,textAlign:"right"},children:e.history.length}),(0,s.jsx)("td",{style:{padding:12},children:e.history.length>0?new Date(e.history[e.history.length-1].date).toLocaleString("fr-FR"):"N/A"})]},e.companyId))})]})]}),"sites"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{fontSize:24,marginBottom:16},children:"Sites de retour"}),(0,s.jsx)("button",{onClick:function(){let e=o.map(e=>({id:e.id,companyId:e.companyId,name:e.name,address:e.address,quotaDailyMax:e.quotaDailyMax,priority:e.priority}));l.exportToCSV(e,"sites-palettes.csv")},style:{padding:"10px 16px",background:"#080",color:"#fff",border:"none",borderRadius:8,cursor:"pointer",marginBottom:16},children:"Exporter CSV"}),(0,s.jsx)("div",{style:{display:"grid",gap:16},children:o.map(e=>(0,s.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:16},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("h3",{style:{fontSize:18,margin:0},children:e.name}),(0,s.jsx)("p",{style:{margin:"4px 0",opacity:.8},children:e.address}),(0,s.jsxs)("p",{style:{margin:"4px 0",fontSize:14},children:[(0,s.jsx)("strong",{children:"Propri\xe9taire:"})," ",e.companyId," | ",(0,s.jsx)("strong",{children:"Priorit\xe9:"})," ",e.priority]}),(0,s.jsxs)("p",{style:{margin:"4px 0",fontSize:14},children:[(0,s.jsx)("strong",{children:"Quota journalier:"})," ",e.quotaDailyMax," palettes"]}),(0,s.jsxs)("p",{style:{margin:"4px 0",fontSize:14},children:[(0,s.jsx)("strong",{children:"Horaires:"})," ",e.openingHours.start," - ",e.openingHours.end]})]}),(0,s.jsx)("div",{style:{display:"flex",gap:8},children:(0,s.jsx)("button",{onClick:()=>R(e.id),style:{padding:"8px 12px",background:"#0a66ff",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},children:"G\xe9rer quota"})})]}),x===e.id&&f&&(0,s.jsxs)("div",{style:{marginTop:16,padding:16,background:"#f9f9f9",borderRadius:8},children:[(0,s.jsx)("h4",{style:{margin:"0 0 12px 0"},children:"Gestion du quota"}),(0,s.jsxs)("p",{children:[(0,s.jsx)("strong",{children:"Quota actuel:"})," ",f.dailyMax," | ",(0,s.jsx)("strong",{children:"Consomm\xe9:"})," ",f.consumed]}),(0,s.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center",marginTop:12},children:[(0,s.jsx)("input",{type:"number",id:"quota-".concat(e.id),defaultValue:f.dailyMax,style:{padding:8,border:"1px solid #ddd",borderRadius:6,width:100}}),(0,s.jsx)("button",{onClick:()=>{let t=parseInt(document.getElementById("quota-".concat(e.id)).value,10);t>0&&w(e.id,t)},style:{padding:"8px 12px",background:"#080",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},children:"Mettre \xe0 jour"})]})]})]},e.id))})]}),"disputes"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{fontSize:24,marginBottom:16},children:"Litiges"}),0===g.length?(0,s.jsx)("p",{style:{opacity:.6},children:"Aucun litige enregistr\xe9"}):(0,s.jsx)("div",{style:{display:"grid",gap:16},children:g.map(e=>(0,s.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:16,background:"OPEN"===e.status?"#fff9e6":"#f9f9f9"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"start"},children:[(0,s.jsxs)("div",{children:[(0,s.jsxs)("h3",{style:{fontSize:18,margin:0},children:["Litige #",e.id]}),(0,s.jsxs)("p",{style:{margin:"4px 0"},children:[(0,s.jsx)("strong",{children:"Ch\xe8que:"})," ",e.chequeId," | ",(0,s.jsx)("strong",{children:"Plaignant:"})," ",e.claimantId]}),(0,s.jsxs)("p",{style:{margin:"4px 0"},children:[(0,s.jsx)("strong",{children:"Raison:"})," ",e.reason]}),(0,s.jsxs)("p",{style:{margin:"4px 0",fontSize:14,opacity:.8},children:["Cr\xe9\xe9 le ",new Date(e.createdAt).toLocaleString("fr-FR")]}),e.comments&&(0,s.jsxs)("p",{style:{margin:"8px 0",fontStyle:"italic"},children:['"',e.comments,'"']})]}),(0,s.jsx)("div",{style:{padding:"6px 12px",borderRadius:6,background:"OPEN"===e.status?"#fa0":"RESOLVED"===e.status?"#080":"#666",color:"#fff",fontSize:14,fontWeight:"bold"},children:e.status})]}),"OPEN"===e.status&&(0,s.jsx)("button",{onClick:()=>alert("Fonctionnalit\xe9 de r\xe9solution \xe0 impl\xe9menter"),style:{marginTop:12,padding:"8px 12px",background:"#080",color:"#fff",border:"none",borderRadius:6,cursor:"pointer"},children:"R\xe9soudre le litige"})]},e.id))})]}),"analytics"===e&&(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{style:{fontSize:24,marginBottom:16},children:"Analytics & Graphiques"}),(0,s.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:16,marginBottom:24},children:[(0,s.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:16},children:[(0,s.jsx)("h3",{style:{fontSize:18,marginBottom:12},children:"R\xe9partition des soldes"}),(0,s.jsxs)("div",{style:{display:"flex",gap:16,alignItems:"center",justifyContent:"center",height:200},children:[(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("div",{style:{fontSize:48,fontWeight:"bold",color:"#080"},children:k.positiveBalances}),(0,s.jsx)("div",{style:{opacity:.8},children:"Cr\xe9dits"})]}),(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("div",{style:{fontSize:48,fontWeight:"bold",color:"#c00"},children:k.negativeBalances}),(0,s.jsx)("div",{style:{opacity:.8},children:"Dettes"})]})]})]}),(0,s.jsxs)("div",{style:{border:"1px solid #ddd",borderRadius:8,padding:16},children:[(0,s.jsx)("h3",{style:{fontSize:18,marginBottom:12},children:"Sites par priorit\xe9"}),(0,s.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:8},children:["INTERNAL","NETWORK","EXTERNAL"].map(e=>{let t=o.filter(t=>t.priority===e).length;return(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:8},children:[(0,s.jsx)("div",{style:{width:100},children:e}),(0,s.jsx)("div",{style:{flex:1,background:"#eee",borderRadius:4,height:24,position:"relative"},children:(0,s.jsx)("div",{style:{background:"INTERNAL"===e?"#0a66ff":"NETWORK"===e?"#080":"#fa0",height:"100%",borderRadius:4,width:"".concat(t/o.length*100,"%")}})}),(0,s.jsx)("div",{style:{width:40,textAlign:"right"},children:t})]},e)})})]})]}),(0,s.jsxs)("div",{style:{padding:16,border:"1px solid #0a66ff",borderRadius:8,background:"#f0f8ff"},children:[(0,s.jsx)("strong",{children:"Graphiques avanc\xe9s:"})," \xc0 venir - \xc9volution des flux, pr\xe9dictions IA, heatmap g\xe9ographique"]})]})]})}}},function(e){e.O(0,[888,774,179],function(){return e(e.s=830)}),_N_E=e.O()}]);