(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[66],{4414:function(t,e,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/storage-market/logisticians",function(){return s(51)}])},4989:function(t,e,s){"use strict";s.d(e,{q:function(){return n}});let a=s(2019).env.NEXT_PUBLIC_STORAGE_MARKET_API_URL||"http://localhost:3013";async function r(t,e){let s=localStorage.getItem("admin_jwt"),r={"Content-Type":"application/json",...s&&{Authorization:"Bearer ".concat(s)},...null==e?void 0:e.headers},n=await fetch("".concat(a).concat(t),{...e,headers:r});if(!n.ok)throw Error((await n.json().catch(()=>({error:"Unknown error"}))).error||"HTTP ".concat(n.status));return n.json()}let n={getStats:async()=>(await r("/storage-market/admin/stats")).stats,getAllNeeds:async t=>{let e=new URLSearchParams;(null==t?void 0:t.status)&&e.set("status",t.status),(null==t?void 0:t.ownerOrgId)&&e.set("ownerOrgId",t.ownerOrgId);let s=e.toString();return(await r(s?"/storage-market/needs?".concat(s):"/storage-market/needs")).items},getNeed:async t=>(await r("/storage-market/needs/".concat(t))).need,moderateNeed:async(t,e)=>(await r("/storage-market/needs/".concat(t),{method:"PUT",body:JSON.stringify(e)})).need,getLogisticians:async()=>(await r("/storage-market/admin/logisticians")).items,approveLogistician:async t=>(await r("/storage-market/admin/logisticians/".concat(t,"/approve"),{method:"POST"})).subscription,rejectLogistician:async(t,e)=>(await r("/storage-market/admin/logisticians/".concat(t,"/reject"),{method:"POST",body:JSON.stringify({reason:e})})).subscription,suspendLogistician:async(t,e)=>(await r("/storage-market/admin/logisticians/".concat(t,"/suspend"),{method:"POST",body:JSON.stringify({reason:e})})).subscription,getAllContracts:async t=>{let e=new URLSearchParams;(null==t?void 0:t.status)&&e.set("status",t.status),(null==t?void 0:t.industrialId)&&e.set("industrialId",t.industrialId),(null==t?void 0:t.logisticianId)&&e.set("logisticianId",t.logisticianId);let s=e.toString();return(await r(s?"/storage-market/contracts?".concat(s):"/storage-market/contracts")).items},getContract:async t=>(await r("/storage-market/contracts/".concat(t))).contract,updateContractStatus:async(t,e,s)=>(await r("/storage-market/contracts/".concat(t,"/status"),{method:"PUT",body:JSON.stringify({status:e,reason:s})})).contract,getOffersForNeed:async t=>(await r("/storage-market/offers/".concat(t))).items,getHealthMetrics:async()=>{let t=await n.getStats();return{averageResponseTime:0,successRate:t.activeContracts/t.totalContracts||0,activeUsers:0,totalRevenue:0}},exportToCSV:(t,e)=>{let s=Object.keys(t[0]||{}),a=new Blob([[s.join(","),...t.map(t=>s.map(e=>JSON.stringify(t[e]||"")).join(","))].join("\n")],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");r.href=URL.createObjectURL(a),r.download=e,r.click()},generateMonthlyReport:async(t,e)=>{throw Error("\xc0 impl\xe9menter - endpoint avec filtres de date requis")}}},51:function(t,e,s){"use strict";s.r(e),s.d(e,{default:function(){return i}});var a=s(7458),r=s(2983),n=s(4989);function i(){let[t,e]=(0,r.useState)([]),[s,i]=(0,r.useState)(!0),[c,o]=(0,r.useState)(null);(0,r.useEffect)(()=>{(async()=>{try{i(!0);let t=await n.q.getLogisticians();e(t)}catch(t){console.error("Error fetching logisticians:",t),o(t instanceof Error?t.message:"Failed to load logisticians")}finally{i(!1)}})()},[]);let l=async t=>{try{await n.q.approveLogistician(t),e(e=>e.map(e=>e.id===t?{...e,status:"APPROVED",approvedAt:new Date().toISOString()}:e))}catch(t){console.error("Error approving logistician:",t),alert("Erreur lors de l'approbation")}},d=async t=>{let s=prompt("Raison du rejet:");if(s)try{await n.q.rejectLogistician(t,s),e(e=>e.map(e=>e.id===t?{...e,status:"REJECTED"}:e))}catch(t){console.error("Error rejecting logistician:",t),alert("Erreur lors du rejet")}};return s?(0,a.jsx)("div",{className:"container mx-auto p-6",children:(0,a.jsx)("div",{className:"flex items-center justify-center py-12",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600",children:"Chargement des logisticiens..."})]})})}):(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-3xl font-bold mb-2",children:"Gestion des Logisticiens"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:"Validation des abonnements et supervision"}),c&&(0,a.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-6",children:(0,a.jsxs)("p",{className:"text-red-800",children:["Erreur: ",c]})}),(0,a.jsxs)("div",{className:"grid grid-cols-3 gap-4 mb-6",children:[(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Total logisticiens"}),(0,a.jsx)("div",{className:"text-3xl font-bold",children:t.length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"Approuv\xe9s"}),(0,a.jsx)("div",{className:"text-3xl font-bold text-green-600",children:t.filter(t=>"APPROVED"===t.status).length})]}),(0,a.jsxs)("div",{className:"bg-white rounded-lg shadow p-4",children:[(0,a.jsx)("div",{className:"text-sm text-gray-600",children:"En attente"}),(0,a.jsx)("div",{className:"text-3xl font-bold text-orange-600",children:t.filter(t=>"PENDING"===t.status).length})]})]}),(0,a.jsx)("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{className:"bg-gray-50",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"ID"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Nom"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Sites"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Contrats actifs"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Date inscription"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Statut"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-sm font-medium text-gray-700",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-200",children:0===t.length?(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:8,className:"px-6 py-12 text-center text-gray-500",children:"Aucun logisticien enregistr\xe9"})}):t.map(t=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-6 py-4 font-medium",children:t.id}),(0,a.jsx)("td",{className:"px-6 py-4",children:"-"}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm text-gray-600",children:"-"}),(0,a.jsx)("td",{className:"px-6 py-4",children:"-"}),(0,a.jsx)("td",{className:"px-6 py-4",children:"-"}),(0,a.jsx)("td",{className:"px-6 py-4 text-sm",children:new Date(t.createdAt).toLocaleDateString("fr-FR")}),(0,a.jsx)("td",{className:"px-6 py-4",children:(0,a.jsx)("span",{className:"px-3 py-1 rounded text-sm ".concat("APPROVED"===t.status?"bg-green-100 text-green-800":"PENDING"===t.status?"bg-orange-100 text-orange-800":"SUSPENDED"===t.status?"bg-gray-100 text-gray-800":"bg-red-100 text-red-800"),children:"APPROVED"===t.status?"Approuv\xe9":"PENDING"===t.status?"En attente":"SUSPENDED"===t.status?"Suspendu":"Rejet\xe9"})}),(0,a.jsxs)("td",{className:"px-6 py-4",children:["PENDING"===t.status&&(0,a.jsxs)("div",{className:"flex gap-2",children:[(0,a.jsx)("button",{onClick:()=>l(t.id),className:"bg-green-600 hover:bg-green-700 text-white px-3 py-1 rounded text-sm",children:"Approuver"}),(0,a.jsx)("button",{onClick:()=>d(t.id),className:"bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm",children:"Rejeter"})]}),"APPROVED"===t.status&&t.approvedAt&&(0,a.jsxs)("span",{className:"text-sm text-gray-600",children:["Approuv\xe9 le ",new Date(t.approvedAt).toLocaleDateString("fr-FR")]})]})]},t.id))})]})})]})}}},function(t){t.O(0,[888,774,179],function(){return t(t.s=4414)}),_N_E=t.O()}]);