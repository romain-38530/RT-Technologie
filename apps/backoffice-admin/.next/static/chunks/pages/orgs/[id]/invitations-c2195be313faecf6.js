(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[874],{6502:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/orgs/[id]/invitations",function(){return i(2129)}])},2129:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return l}});var n=i(7458),a=i(2983),r=i(3731);let s="http://3.76.34.154:3000";function l(){let{id:e}=(0,r.useRouter)().query,[t,i]=(0,a.useState)([]),[l,o]=(0,a.useState)([]),[c,u]=(0,a.useState)(!1),[d,h]=(0,a.useState)(null),[m,g]=(0,a.useState)(null),[p,f]=(0,a.useState)(""),[x,j]=(0,a.useState)(""),[w,y]=(0,a.useState)(""),v=async()=>{if(e){u(!0),h(null);try{let t={};{let e=window.localStorage.getItem("admin_jwt");e&&(t.authorization="Bearer ".concat(e))}let n=await fetch("".concat(s,"/admin/orgs/").concat(e,"/invitations"),{headers:t}),a=await n.json();i(a.invitedCarriers||[])}catch(e){h(e.message||"Erreur r\xe9seau")}finally{u(!1)}}};(0,a.useEffect)(()=>{v()},[e]),(0,a.useEffect)(()=>{(async()=>{try{let e={};{let t=window.localStorage.getItem("admin_jwt");t&&(e.authorization="Bearer ".concat(t))}let t=await fetch("".concat(s,"/admin/carriers"),{headers:e}),i=await t.json();o(i.items||[])}catch(e){}})()},[]),(0,a.useEffect)(()=>{let e=setTimeout(()=>y(x.trim().toLowerCase()),250);return()=>clearTimeout(e)},[x]);let b=(0,a.useMemo)(()=>w?l.filter(e=>e.id.toLowerCase().includes(w)||(e.name||"").toLowerCase().includes(w)||(e.email||"").toLowerCase().includes(w)):l,[l,w]),C=e=>{(e=e.trim())&&i(t=>t.includes(e)?t:[...t,e])},S=e=>i(t=>t.filter(t=>t!==e)),_=async()=>{if(e){u(!0),h(null),g(null);try{let i={"content-type":"application/json"};{let e=window.localStorage.getItem("admin_jwt");e&&(i.authorization="Bearer ".concat(e))}await fetch("".concat(s,"/admin/orgs/").concat(e,"/invitations"),{method:"POST",headers:i,body:JSON.stringify({invitedCarriers:t})}),g("Invitations mises \xe0 jour")}catch(e){h(e.message||"Erreur r\xe9seau")}finally{u(!1)}}},E=async()=>{if(e){u(!0),h(null),g(null);try{let t={};{let e=window.localStorage.getItem("admin_jwt");e&&(t.authorization="Bearer ".concat(e))}await fetch("".concat(s,"/admin/orgs/").concat(e,"/invitations/apply"),{method:"POST",headers:t}),g("Invitations appliqu\xe9es aux flux existants (stub)")}catch(e){h(e.message||"Erreur r\xe9seau")}finally{u(!1)}}};return e?(0,n.jsxs)("main",{children:[(0,n.jsxs)("h2",{children:["Invitations transporteurs — Org ",e]}),d&&(0,n.jsx)("p",{style:{color:"red"},children:d}),m&&(0,n.jsx)("p",{style:{color:"green"},children:m}),(0,n.jsxs)("div",{style:{display:"flex",gap:8,marginBottom:12,alignItems:"center"},children:[(0,n.jsx)("input",{list:"carrier-suggestions",value:p,onChange:e=>f(e.target.value),placeholder:"ID transporteur (ex: B)"}),(0,n.jsx)("datalist",{id:"carrier-suggestions",children:l.map(e=>(0,n.jsx)("option",{value:e.id,children:e.name},e.id))}),(0,n.jsx)("button",{onClick:()=>{C(p),f("")},disabled:c,children:"Ajouter"})]}),(0,n.jsxs)("div",{style:{marginBottom:12},children:[(0,n.jsx)("strong",{children:"Suggestions:"}),(0,n.jsx)("div",{style:{margin:"8px 0"},children:(0,n.jsx)("input",{value:x,onChange:e=>j(e.target.value),placeholder:"Filtrer par id/nom/email"})}),(0,n.jsx)("ul",{children:b.filter(e=>!t.includes(e.id)).slice(0,12).map(e=>(0,n.jsxs)("li",{children:[e.id," — ",e.name," ",e.email?"(".concat(e.email,")"):""," ",e.blocked?"— bloqu\xe9 vigilance":"",(0,n.jsx)("button",{style:{marginLeft:8},onClick:()=>C(e.id),disabled:c,children:"Ajouter"})]},e.id))})]}),(0,n.jsx)("h3",{children:"Transporteurs invit\xe9s"}),(0,n.jsx)("ul",{children:t.map(e=>(0,n.jsxs)("li",{children:[e," ",(0,n.jsx)("button",{onClick:()=>S(e),disabled:c,children:"Retirer"})]},e))}),(0,n.jsxs)("div",{style:{marginTop:16,display:"flex",gap:8},children:[(0,n.jsx)("button",{onClick:_,disabled:c,children:"Enregistrer"}),(0,n.jsx)("button",{onClick:E,disabled:c,children:"Appliquer aux flux existants"})]}),(0,n.jsx)("p",{style:{marginTop:12},children:(0,n.jsx)("a",{href:"/orgs/".concat(e),children:"← Retour organisation"})})]}):(0,n.jsx)("p",{children:"Chargement…"})}},3731:function(e,t,i){e.exports=i(6164)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=6502)}),_N_E=e.O()}]);