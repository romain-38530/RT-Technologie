version: 1
applications:
  - appRoot: apps/marketing-site
    frontend:
      phases:
        preBuild:
          commands:
            - npm install -g pnpm
            - cd ../..
            - pnpm install
        build:
          commands:
            - cd apps/marketing-site
            - pnpm run build
            # Créer un dossier de sortie propre
            - mkdir -p ./build-output
            # Copier .next
            - cp -r .next ./build-output/.next
            # Copier node_modules à la racine du build-output
            - cp -r ../../node_modules ./build-output/node_modules
            # Copier package.json
            - cp package.json ./build-output/package.json
            # Copier public si existe
            - cp -r public ./build-output/public 2>/dev/null || true
      artifacts:
        baseDirectory: build-output
        files:
          - '**/*'
      cache:
        paths:
          - ../../node_modules/**/*
          - .next/cache/**/*
