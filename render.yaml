services:
  - name: authz
    type: web
    env: node
    rootDir: services/authz
    buildCommand: "corepack enable && pnpm install --frozen-lockfile"
    startCommand: "node src/server.js"
    plan: free
    autoDeploy: true
    envVars:
      - key: PORT
        value: 3007
      - key: AUTHZ_PORT
        value: 3007
      - key: AUTHZ_JWT_SECRET
        sync: false
      - key: AUTHZ_VERIFY_BASE_URL
        value: https://authz.rt-technologie.com
      - key: SECURITY_ENFORCE
        value: "true"
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DB
        value: rt
  - name: admin-gateway
    type: web
    env: node
    rootDir: services/admin-gateway
    buildCommand: "corepack enable && pnpm install --frozen-lockfile"
    startCommand: "node src/server.js"
    plan: free
    autoDeploy: true
    healthCheckPath: /admin/health
    envVars:
      - key: PORT
        value: 3008
      - key: ADMIN_GATEWAY_PORT
        value: 3008
      - key: AUTHZ_URL
        value: https://authz.rt-technologie.com
      - key: CORE_ORDERS_URL
        value: https://core-orders.rt-technologie.com
      - key: PLANNING_URL
        value: https://planning.rt-technologie.com
      - key: VIGILANCE_URL
        value: https://vigilance.rt-technologie.com
      - key: NOTIFICATIONS_URL
        value: https://notifications.rt-technologie.com
      - key: ECPMR_URL
        value: https://ecpmr.rt-technologie.com
      - key: SECURITY_ENFORCE
        value: "true"
      - key: INTERNAL_SERVICE_TOKEN
        sync: false
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DB
        value: rt
      - key: CORS_ALLOW_ORIGIN
        value: https://www.rt-technologie.com
  - name: core-orders
    type: web
    env: node
    rootDir: services/core-orders
    buildCommand: "corepack enable && pnpm install --frozen-lockfile"
    startCommand: "node src/server.js"
    plan: free
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: 3001
      - key: SECURITY_ENFORCE
        value: "true"
      - key: INTERNAL_SERVICE_TOKEN
        sync: false
      - key: VIGILANCE_URL
        value: https://vigilance.rt-technologie.com
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DB
        value: rt
      - key: CORS_ALLOW_ORIGIN
        value: https://www.rt-technologie.com
  - name: planning
    type: web
    env: node
    rootDir: services/planning
    buildCommand: "corepack enable && pnpm install --frozen-lockfile"
    startCommand: "node src/server.js"
    plan: free
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: 3004
      - key: SECURITY_ENFORCE
        value: "true"
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DB
        value: rt
      - key: CORS_ALLOW_ORIGIN
        value: https://www.rt-technologie.com
  - name: vigilance
    type: web
    env: node
    rootDir: services/vigilance
    buildCommand: "corepack enable && pnpm install --frozen-lockfile"
    startCommand: "node src/server.js"
    plan: free
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: 3006
      - key: SECURITY_ENFORCE
        value: "true"
      - key: VATCHECK_API_KEY
        sync: false
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DB
        value: rt
      - key: CORS_ALLOW_ORIGIN
        value: https://www.rt-technologie.com
  - name: notifications
    type: web
    env: node
    rootDir: services/notifications
    buildCommand: "corepack enable && pnpm install --frozen-lockfile"
    startCommand: "node src/server.js"
    plan: free
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: 3002
      - key: NOTIFICATIONS_PORT
        value: 3002
      - key: MAILGUN_DOMAIN
        sync: false
      - key: MAILGUN_API_KEY
        sync: false
      - key: MAIL_FROM
        value: "RT Technologie <no-reply@rt-technologie.com>"
      - key: NOTIFICATIONS_SES_FROM
        value: "RT Technologie <no-reply@rt-technologie.com>"
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: AWS_REGION
        value: eu-west-3
      - key: CORS_ALLOW_ORIGIN
        value: https://www.rt-technologie.com
  - name: ecpmr
    type: web
    env: node
    rootDir: services/ecpmr
    buildCommand: "corepack enable && pnpm install --frozen-lockfile"
    startCommand: "node src/server.js"
    plan: free
    autoDeploy: true
    healthCheckPath: /health
    envVars:
      - key: PORT
        value: 3009
      - key: ECPMR_PORT
        value: 3009
      - key: AWS_S3_BUCKET
        sync: false
      - key: AWS_ACCESS_KEY_ID
        sync: false
      - key: AWS_SECRET_ACCESS_KEY
        sync: false
      - key: AWS_REGION
        value: eu-west-3
      - key: MONGODB_URI
        sync: false
      - key: MONGODB_DB
        value: rt
      - key: CORS_ALLOW_ORIGIN
        value: https://www.rt-technologie.com
